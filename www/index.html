<!DOCTYPE html>
<html>
<!--
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name = "format-detection" content = "telephone=no"/>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width;" />
        <link rel="stylesheet" type="text/css" href="css/jquery-mobile.css" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />


        <title>Gozintas</title>
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-1.2.0.js"></script>
        <script type="text/javascript" src="cordova-2.2.0.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/Gozintas.js"></script>
        <script type="text/javascript" src="js/page.js"></script>
        <script type="text/javascript" src="js/partial.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
    </head>
    <body>
        <div data-role="page" id="one" data-routing="page1.html">
        </div>

        <div data-role="page" id="two" data-add-back-btn="true" data-routing="page2.html" data-pagejs="page2">
            <script> 
                $("#two").live(
                    "pagebeforeshow",
                    function () {
                        Gozintas.showSplitTipButtons();
                    }
                );

            </script>        
        </div>

        <div data-role="page" id="three" data-add-back-btn="true" data-routing="page3.html">
            <script>
                $(".group_nickname").live('keyup',function(){
                    group = $(this).parent().parent().parent().attr("class").split(" ")[0]
                    parentClass = "."+group+" ";
                    groupNum = parseFloat(group.split("-")[1])
                    textInput = $(parentClass+'.group_nickname').val();
                    groups[groupNum-1].nickname = textInput
                    elToRemove = $("#three "+parentClass+"h3 span.ui-btn-text");
                    final_elToRemove = $("#five "+parentClass+"h3 span.ui-btn-text");
                    if(final_elToRemove.length == 0){
                        final_elToRemove = $("#five "+parentClass+"h3");
                    }
                    children = elToRemove.children().detach();
                    finalChildren = final_elToRemove.children().detach();
                    elToRemove.html(textInput);
                    final_elToRemove.html(textInput);
                    elToRemove.append(children);
                    final_elToRemove.append(finalChildren);
                });

                $("#three #people_in_group").live('keyup',function(){
                    group = $(this).parent().parent().parent().attr("class").split(" ")[0];
                    parentClass = "."+group+" ";
                    groupNum = parseFloat(group.split("-")[1])
                    peopleInParty = parseFloat($(parentClass+'#people_in_group').val());
                    groups[groupNum-1].peopleInParty = peopleInParty;
                })

                $("#three #drinks_deserts_etc").live('keyup',function(){
                    group = $(this).parent().parent().parent().attr("class").split(" ")[0];
                    parentClass = "."+group+" ";
                    groupNum = parseFloat(group.split("-")[1])
                    foodTotal = parseFloat($(parentClass+'#drinks_deserts_etc').val()).toFixed(2);
                    groups[groupNum-1].foodTotal = foodTotal;
                    if(groups[groupNum-1].foodTotal > 0){
                        groups[groupNum-1].extras = true
                        groups[groupNum-1].reduction = true
                    }else{
                        if(groups[groupNum-1].foodTotal >=0 || groups[groupNum-1].carryOutTotal >=0 || groups[groupNum-1].wineTotal >= 0 || groups[groupNum-1].reductionTotal >= 0){
                            groups[groupNum-1].reduction = true
                        }else{
                            groups[groupNum-1].reduction = false
                            groups[groupNum-1].extras = false
                        }
                    }
                })

                $("#three #wine_amount").live('keyup',function(){
                    group = $(this).parent().parent().parent().attr("class").split(" ")[0];
                    parentClass = "."+group+" ";
                    groupNum = parseFloat(group.split("-")[1])
                    wineTotal = parseFloat($(parentClass+'#wine_amount').val()).toFixed(2);
                    groups[groupNum-1].wineTotal = wineTotal;
                    if(groups[groupNum-1].wineTotal > 0){
                        groups[groupNum-1].wine = true
                        groups[groupNum-1].reduction = true
                    }else{
                        groups[groupNum-1].wine = false
                        if(groups[groupNum-1].foodTotal >=0 || groups[groupNum-1].carryOutTotal >=0 || groups[groupNum-1].wineTotal >= 0 || groups[groupNum-1].reductionTotal >= 0){
                            groups[groupNum-1].reduction = true
                        }else{
                            groups[groupNum-1].reduction = false
                        }
                    }
                })


                $("#three #carry_out_amount").live('keyup',function(){
                    group = $(this).parent().parent().parent().attr("class").split(" ")[0];
                    parentClass = "."+group+" ";
                    groupNum = parseFloat(group.split("-")[1])
                    carryOut = parseFloat($(parentClass+'#carry_out_amount').val()).toFixed(2);
                    groups[groupNum-1].carryOutTotal = carryOut;
                    if(groups[groupNum-1].carryOutTotal > 0){
                        groups[groupNum-1].carryout = true
                        groups[groupNum-1].reduction = true
                    }else{
                        groups[groupNum-1].carryout = false
                        if(groups[groupNum-1].foodTotal >=0 || groups[groupNum-1].carryOutTotal >=0 || groups[groupNum-1].wineTotal >= 0 || groups[groupNum-1].reductionTotal >= 0){
                            groups[groupNum-1].reduction = true
                        }else{
                            groups[groupNum-1].reduction = false
                        }
                    }
                })

                $("#three #fair_reduction").live('keyup',function(){
                    group = $(this).parent().parent().parent().attr("class").split(" ")[0];
                    parentClass = "."+group+" ";
                    groupNum = parseFloat(group.split("-")[1])
                    fairReduction = parseFloat($(parentClass+'#fair_reduction').val()).toFixed(2);
                    groups[groupNum-1].reductionTotal = fairReduction;
                    if(groups[groupNum-1].reductionTotal > 0){
                        groups[groupNum-1].reduction = true
                    }else{
                        if(groups[groupNum-1].foodTotal >=0 || groups[groupNum-1].carryOutTotal >=0 || groups[groupNum-1].wineTotal >= 0 || groups[groupNum-1].reductionTotal >= 0){
                            groups[groupNum-1].reduction = true
                        }else{
                            groups[groupNum-1].reduction = false
                        }
                    }
                })


            </script>
        </div>

        <div data-role="page" id="three-b" data-add-back-btn="true" data-routing="page3b.html">
            <script>
                $("#three-b").live('pageshow',function(){
                    groups.length = 1
                    groups[0] = new Group();
                    $("#three-b #drinks_deserts_etc").val(Gozintas.totalAmount-Gozintas.taxAmount);
                    $("#three-b #people_in_party").focusout(function() {
                        groups[0].peopleInParty = parseFloat($(this).val());
                    });
                });

                $("#three-b").live('keyup',function(){
                    parentClass = "#three-b";
                    peopleInParty = parseFloat($(parentClass+' #people_in_party').val())
                    wineTotal = parseFloat($(parentClass+' #wine_amount').val()).toFixed(2);
                    carryOut = parseFloat($(parentClass+' #carry_out_amount').val()).toFixed(2);

                    if(carryOut == "NaN"){
                        carryOut = 0
                    }
                    if(wineTotal == "NaN"){
                        wineTotal = 0
                    }
                    console.log(peopleInParty+" "+wineTotal+" "+carryOut);

                    groups[0].peopleInParty = peopleInParty
                    groups[0].wineTotal = wineTotal;
                    groups[0].carryOutTotal = carryOut
                    groups[0].foodTotal = +Gozintas.totalAmount - +Gozintas.taxAmount
                    newFoodTotal = Gozintas.totalAmount-Gozintas.taxAmount-groups[0].wineTotal-groups[0].carryOutTotal -groups[0].reductionTotal;
                    groups[0].foodTotal = newFoodTotal

                    if(groups[0].foodTotal > 0){
                        groups[0].extras =true;
                    }else{
                        groups[0].extras = false
                    }
                    if(groups[0].wineTotal > 0){
                        groups[0].wine = true
                    }else{
                        groups[0].wine = false
                    }
                    if(groups[0].carryOutTotal > 0){
                        groups[0].carryout = true
                    }else{
                        groups[0].carryout = false
                    }

                    $("#three-b #drinks_deserts_etc").val(+newFoodTotal.toFixed(2));
                })
            </script>
        </div>

        <div data-role="page" id="four" data-add-back-btn="true" data-routing="page4.html">
            <script> 
                $("#four").live(
                    "pagebeforeshow",
                    function(){
                        Gozintas.showPageFourPercentages();
                    }
                );
                $("#four").live(
                    "pageshow",
                    function () {
                        Gozintas.showPageFourButton();
                    }
                );

                $("#four").live(
                    "pageshow",
                    function() {
                    $("#four #tip_rate").focusout(function() {
                        Gozintas.tipAmount = parseFloat($(this).val());
                    });
                    $("#four #tax_tip_rate").focusout(function() {
                        Gozintas.taxTipAmount = parseFloat($(this).val());
                    });
                    $("#four #wine_tip_rate").focusout(function() {
                        Gozintas.wineTipAmount = parseFloat($(this).val());
                    });
                    $("#four #carry_tip_rate").focusout(function() {
                        Gozintas.carryTipAmount = parseFloat($(this).val());
                    });
                    $("#four #tax_tip_rate").focusout(function() {
                        Gozintas.taxTipAmount = parseFloat($(this).val());
                    });
                });
            </script> 
        </div>

        <div data-role="page" id="five" data-add-back-btn="true" data-routing="page5.html">
            <script>
                $("#five").live(
                    "pagebeforeshow",
                    function () {
                        Gozintas.peopleInParty = 0;
                        for(var i=0; i<groups.length; i++){
                            Gozintas.peopleInParty = +Gozintas.peopleInParty + groups[i].peopleInParty;
                        }

                        
                        Gozintas.totalWithoutReduction = Gozintas.totalAmount
                        for(var i=0; i<groups.length; i++){
                            if(groups[i].extras){
                                Gozintas.totalWithoutReduction = (+Gozintas.totalWithoutReduction - +groups[i].foodTotal).toFixed(2)
                            }
                            if(groups[i].carryout){
                                Gozintas.totalWithoutReduction = (+Gozintas.totalWithoutReduction - +groups[i].carryOutTotal).toFixed(2)
                            }
                            if(groups[i].wine){
                                Gozintas.totalWithoutReduction = (+Gozintas.totalWithoutReduction - +groups[i].wineTotal).toFixed(2)
                            }
                        }

                        Gozintas.totalIndividual = (+Gozintas.totalWithoutReduction/Gozintas.peopleInParty).toFixed(2)
                        Gozintas.totalTaxIndividual = (+Gozintas.taxAmount/Gozintas.peopleInParty).toFixed(2)
                        for(var i=0; i<groups.length; i++){
                            var totalAddition = 0
                            if(groups[i].extras){
                                totalAddition = totalAddition + +groups[i].foodTotal
                            }
                            if(groups[i].carryout){
                                totalAddition = totalAddition + +groups[i].carryOutTotal
                            }
                            if(groups[i].wine){
                                totalAddition = totalAddition + +groups[i].wineTotal
                            }
                            groups[i].total = (+Gozintas.totalIndividual * +groups[i].peopleInParty + +totalAddition).toFixed(2)
                            groups[i].taxTotal = (+Gozintas.totalTaxIndividual * +groups[i].peopleInParty).toFixed(2)
                        }

                        for(var i=0; i<groups.length; i++){
                            var foodTotal = (+groups[i].total- +groups[i].taxTotal - +groups[i].foodTotal - groups[i].carryOutTotal - groups[i].wineTotal).toFixed(2)
                            var tipTotal = ((+foodTotal)*Gozintas.tipAmount + +groups[i].foodTotal*Gozintas.tipAmount + +groups[i].carryOutTotal*Gozintas.carryTipAmount + +groups[i].wineTotal*Gozintas.wineTipAmount + +groups[i].taxTotal*Gozintas.taxTipAmount).toFixed(2)
                            var finalTotal = +groups[i].total + +tipTotal;
                            $("#five #group-"+(i+1)+" #individuals_in_party").val(groups[i].peopleInParty)
                            $("#five #group-"+(i+1)+" #total").val(finalTotal)
                            $("#five #group-1 .food_total label").text("Food Total ("+(Gozintas.tipAmount*100).toFixed()+"% tip rate)")
                            $("#five #group-"+(i+1)+" #food_total").val(+foodTotal)
                            
                           $("#five #group-1 #drinks_deserts_amount_container label").text("Drinks/Deserts/Etc ("+(Gozintas.tipAmount*100).toFixed()+"% tip rate)")

                           $("#five #group-1 #wine_amount_container label").text("Wine ("+(Gozintas.wineTipAmount*100).toFixed()+"% tip rate)")

                           $("#five #group-1 #carry_out_amount_container label").text("Carry-out for group ("+(Gozintas.carryTipAmount*100).toFixed()+"% tip rate)")
                            $("#five #group-"+(i+1)+" #total_individual").val((+finalTotal/+groups[i].peopleInParty).toFixed(2))
                            $("#five #group-1 .tax_total label").text("Tax for group ("+(Gozintas.taxTipAmount*100).toFixed()+"% tip rate)")
                            $("#five #group-"+(i+1)+" #tax_total").val(+groups[i].taxTotal)
                            
                            $("#five #group-"+(i+1)+" #tip_total").val(tipTotal)
                            $("#five #group-"+(i+1)+" #tip_individual").val((tipTotal/groups[i].peopleInParty).toFixed(2))
                            if(groups[i].wine){
                                $("#five #group-"+(i+1)+" #wine_amount_container").show()
                                $("#five #group-"+(i+1)+" #wine_amount").val(groups[i].wineTotal)
                            }else{
                                $("#five #group-"+(i+1)+" #wine_amount_container").hide()
                            }
                            if(groups[i].carryout){
                                $("#five #group-"+(i+1)+" #carry_out_amount_container").show()
                                $("#five #group-"+(i+1)+" #carry_out_amount").val(groups[i].carryOutTotal)
                            }else{
                                $("#five #group-"+(i+1)+" #carry_out_amount_container").hide()
                            }
                            if(groups[i].extras){
                                $("#five #group-"+(i+1)+" #drinks_deserts_amount_container").show()
                                $("#five #group-"+(i+1)+" #drinks_deserts_amount").val(groups[i].foodTotal)
                            }else{
                                $("#five #group-"+(i+1)+" #drinks_deserts_amount_container").hide()
                            }
                        }

                        $(".page5.total input").val($("#total_amount_input").val())
                        $(".page5.tax input").val($("#total_tax_amount_input").val())
                        if(!Gozintas.billModifier.wine){
                            $(".page5.wine_tip").hide();
                            $(".page5.wine").hide();
                        }
                        if(!Gozintas.billModifier.reductions){
                            $(".page5.reductions").hide();
                        }
                        if(!Gozintas.billModifier.extras){
                            $(".page5.extras").hide();
                        }
                    }
                );
            </script>
        </div>

        <div data-role="page" id="fiveb" data-add-back-btn="true" data-routing="page5b.html">
            <script>
                $("#fiveb").live(
                    "pagebeforeshow",
                    function () {
                        if(Gozintas.billPath == "determine-tip" || (Gozintas.billPath == "split-tip" && Gozintas.splitBy == "individual")){
                            groups[0].foodTotal = +Gozintas.totalAmount - +Gozintas.taxAmount
                        }

                        $("#fiveb input#individuals_in_party").val(groups[0].peopleInParty);
                        $("#fiveb input#food_total").val("$"+groups[0].foodTotal);
                        $("#fiveb input#wine_total").val("$"+groups[0].wineTotal);
                        $("#fiveb input#carryout_total").val("$"+groups[0].carryOutTotal);
                        $("#fiveb .food_total label").text("Food Total ("+(Gozintas.tipAmount*100).toFixed()+"% tip rate)")
                        $("#fiveb .wine_total label").text("Wine Total ("+(Gozintas.wineTipAmount*100).toFixed()+"% tip rate)")
                        $("#fiveb .carryout_total label").text("Carry-out Total ("+(Gozintas.carryTipAmount*100).toFixed()+"% tip rate)")
                        $("#fiveb .tax_total label").text("Tax ("+(Gozintas.taxTipAmount*100).toFixed()+"% tip rate)")
                        $("#fiveb input#tax_total").val("$"+Gozintas.taxAmount);
                        Gozintas.showPageFiveInputs();
                        $("#fiveb input#tip_total").val("$"+Gozintas.calculateTip());
                        $("#fiveb input#total").val("$"+Gozintas.calculateTotal());
                        $("#fiveb input#tip_individual").val("$"+Gozintas.calculateTipIndividual());
                        $("#fiveb input#total_individual").val("$"+Gozintas.calculateTotalIndividual());
                    }
                );
            </script>
        </div>
    </body>
</html>
